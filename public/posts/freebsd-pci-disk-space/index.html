<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Freebsd Pci Disk Space | Le Baron de Charlus</title>
<meta name="title" content="Freebsd Pci Disk Space" />
<meta name="description" content="When you create an OVH Public Cloud instance under Freebsd with a certain amount of disk space, let’s say 50G, you will find that it is not applied on your partition.
First let&rsquo;s look at what we have:
# gpart show =&gt; 40 10239920 da0 GPT (50G) [CORRUPT] 40 1024 1 freebsd-boot (512K) 1064 984 - free - (492K) 2048 10235904 2 freebsd-zfs (4.9G) 10237952 2008 - free - (1.0M) We note that our volume da0 is tagged as CORRUPT." />
<meta name="keywords" content="freebsd,ovh,serveur,publicloud," />


<meta property="og:title" content="Freebsd Pci Disk Space" />
<meta property="og:description" content="When you create an OVH Public Cloud instance under Freebsd with a certain amount of disk space, let’s say 50G, you will find that it is not applied on your partition.
First let&rsquo;s look at what we have:
# gpart show =&gt; 40 10239920 da0 GPT (50G) [CORRUPT] 40 1024 1 freebsd-boot (512K) 1064 984 - free - (492K) 2048 10235904 2 freebsd-zfs (4.9G) 10237952 2008 - free - (1.0M) We note that our volume da0 is tagged as CORRUPT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lebaron.sh/posts/freebsd-pci-disk-space/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-03-04T14:56:33+00:00" />
<meta property="article:modified_time" content="2018-03-04T14:56:33+00:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Freebsd Pci Disk Space"/>
<meta name="twitter:description" content="When you create an OVH Public Cloud instance under Freebsd with a certain amount of disk space, let’s say 50G, you will find that it is not applied on your partition.
First let&rsquo;s look at what we have:
# gpart show =&gt; 40 10239920 da0 GPT (50G) [CORRUPT] 40 1024 1 freebsd-boot (512K) 1064 984 - free - (492K) 2048 10235904 2 freebsd-zfs (4.9G) 10237952 2008 - free - (1.0M) We note that our volume da0 is tagged as CORRUPT."/>



<meta itemprop="name" content="Freebsd Pci Disk Space">
<meta itemprop="description" content="When you create an OVH Public Cloud instance under Freebsd with a certain amount of disk space, let’s say 50G, you will find that it is not applied on your partition.
First let&rsquo;s look at what we have:
# gpart show =&gt; 40 10239920 da0 GPT (50G) [CORRUPT] 40 1024 1 freebsd-boot (512K) 1064 984 - free - (492K) 2048 10235904 2 freebsd-zfs (4.9G) 10237952 2008 - free - (1.0M) We note that our volume da0 is tagged as CORRUPT."><meta itemprop="datePublished" content="2018-03-04T14:56:33+00:00" />
<meta itemprop="dateModified" content="2018-03-04T14:56:33+00:00" />
<meta itemprop="wordCount" content="452">
<meta itemprop="keywords" content="freebsd,ovh,serveur,publicloud," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Le Baron de Charlus</h2>
</a>
<nav><a href="/">Home</a>

<a href="/posts/">Posts</a>

<a href="/tags/">Tags</a>

<a href="/photography/">Photography</a>

<a href="/cv">CV</a>

<a href="/index.xml"></a>


</nav>
</header>
  <main>

<content>
  <p>When you create an OVH Public Cloud instance under Freebsd with a certain amount of disk space, let’s say 50G, you will find that it is not applied on your partition.</p>
<p>First let&rsquo;s look at what we have:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart show
</span></span><span style="display:flex;"><span>=&gt;      40  10239920  da0  GPT  (50G) [CORRUPT]
</span></span><span style="display:flex;"><span>        40      1024    1  freebsd-boot  (512K)
</span></span><span style="display:flex;"><span>      1064       984       - free -  (492K)
</span></span><span style="display:flex;"><span>      2048  10235904    2  freebsd-zfs  (4.9G)
</span></span><span style="display:flex;"><span>  10237952      2008       - free -  (1.0M)
</span></span></code></pre></div><p>We note that our volume da0 is tagged as CORRUPT. Don&rsquo;t panic, everyone knows that the Freebsd handbook is great. I quote:</p>
<blockquote>
<p>If the disk was formatted with the GPT partitioning scheme, it may show as “corrupted” because the GPT backup partition table is no longer at the end of the drive. Fix the backup partition table with gpart:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart recover ada0
</span></span><span style="display:flex;"><span>ada0 recovered
</span></span></code></pre></div><p>Well, let&rsquo;s apply this to our server by replacing <code>ada0</code> by <code>da0</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart recover da0
</span></span><span style="display:flex;"><span>da0 recovered
</span></span></code></pre></div><p>Check :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart show
</span></span><span style="display:flex;"><span>=&gt;       40  104857520  da0  GPT  (50G)
</span></span><span style="display:flex;"><span>         40       1024    1  freebsd-boot  (512K)
</span></span><span style="display:flex;"><span>       1064        984       - free -  (492K)
</span></span><span style="display:flex;"><span>       2048   10235904    2  freebsd-zfs  (4.9G)
</span></span><span style="display:flex;"><span>   10237952   94619608       - free -  (45G)
</span></span></code></pre></div><p>Much better!
We see that our da0 &ldquo;disk&rdquo; has 50G. However if we look more closely at our system, we see that not all the space is present.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># df -h
</span></span><span style="display:flex;"><span>Filesystem            Size    Used   Avail Capacity  Mounted on
</span></span><span style="display:flex;"><span>zroot/ROOT/default    4.7G    493M    4.2G    10%    /
</span></span><span style="display:flex;"><span>devfs                 1.0K    1.0K      0B   100%    /dev
</span></span><span style="display:flex;"><span>zroot                 4.2G     96K    4.2G     0%    /zroot
</span></span></code></pre></div><p>Once again, don&rsquo;t panic. The handbook is our friend.</p>
<p>Let&rsquo;s apply the 45G free on our score :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart resize -i 2 -a 4k -s 50G da0
</span></span><span style="display:flex;"><span>da0p2 resized
</span></span></code></pre></div><p>Check :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># gpart show
</span></span><span style="display:flex;"><span>=&gt;       40  104857520  da0  GPT  (50G)
</span></span><span style="display:flex;"><span>         40       1024    1  freebsd-boot  (512K)
</span></span><span style="display:flex;"><span>       1064        984       - free -  (492K)
</span></span><span style="display:flex;"><span>       2048   94371840    2  freebsd-zfs  (45G)
</span></span><span style="display:flex;"><span>   94373888   10483672       - free -  (5.0G)
</span></span></code></pre></div><p>Well, we are moving forward, however, the space is not yet usable as the return from df :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># df -h
</span></span><span style="display:flex;"><span>Filesystem            Size    Used   Avail Capacity  Mounted on
</span></span><span style="display:flex;"><span>zroot/ROOT/default    4.7G    493M    4.2G    10%    /
</span></span><span style="display:flex;"><span>devfs                 1.0K    1.0K      0B   100%    /dev
</span></span><span style="display:flex;"><span>zroot                 4.2G     96K    4.2G     0%    /zroot
</span></span></code></pre></div><p>We must ask to our zpool to use this space.</p>
<p>Let’s first check our pool.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># zpool status
</span></span><span style="display:flex;"><span>  pool: zroot
</span></span><span style="display:flex;"><span> state: ONLINE
</span></span><span style="display:flex;"><span>  scan: none requested
</span></span><span style="display:flex;"><span>config:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	NAME        STATE     READ WRITE CKSUM
</span></span><span style="display:flex;"><span>	zroot       ONLINE       0     0     0
</span></span><span style="display:flex;"><span>	  da0p2     ONLINE       0     0     0
</span></span></code></pre></div><p>Ask it we want to autoexpand on zroot</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># zpool set autoexpand=on zroot
</span></span></code></pre></div><p>Apply it on da0p2 :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># zpool online -e zroot /dev/da0p2
</span></span></code></pre></div><p>Last check :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># df -h
</span></span><span style="display:flex;"><span>Filesystem            Size    Used   Avail Capacity  Mounted on
</span></span><span style="display:flex;"><span>zroot/ROOT/default     44G    493M     43G     1%    /
</span></span><span style="display:flex;"><span>devfs                 1.0K    1.0K      0B   100%    /dev
</span></span><span style="display:flex;"><span>zroot                  43G     96K     43G     0%    /zroot
</span></span></code></pre></div><p>This is it !</p>

</content>
<p>
  
  <a href="https://lebaron.sh/tags/freebsd/">#freebsd</a>
  
  <a href="https://lebaron.sh/tags/ovh/">#ovh</a>
  
  <a href="https://lebaron.sh/tags/serveur/">#serveur</a>
  
  <a href="https://lebaron.sh/tags/publicloud/">#publicloud</a>
  
</p>

  </main>
  <footer><a href="https://lebaron.sh">© lebaron.sh</a>
</footer>

    
</body>

</html>
