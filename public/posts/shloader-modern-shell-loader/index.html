<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shloader - A Modern Shell Loader | Le Baron de Charlus</title>
<meta name="title" content="Shloader - A Modern Shell Loader" />
<meta name="description" content="Why Features Preview Templating Usage Parsing Arguments Shell Configurations Trap Error and Exit Display Loader Call Loader Scrip Library Integration Conclusion  Why I&rsquo;ve been recently doing some old shell scripts to quickly automatize and distribute actions that were made manually, I&rsquo;ll write a post on it later. For now I&rsquo;d like to share with you how I&rsquo;ve been coding a 100% shell loader library to use it in my scripts." />
<meta name="keywords" content="loader,shell,bash," />


<meta property="og:title" content="Shloader - A Modern Shell Loader" />
<meta property="og:description" content="Why Features Preview Templating Usage Parsing Arguments Shell Configurations Trap Error and Exit Display Loader Call Loader Scrip Library Integration Conclusion  Why I&rsquo;ve been recently doing some old shell scripts to quickly automatize and distribute actions that were made manually, I&rsquo;ll write a post on it later. For now I&rsquo;d like to share with you how I&rsquo;ve been coding a 100% shell loader library to use it in my scripts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lebaron.sh/posts/shloader-modern-shell-loader/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-25T18:03:17+02:00" />
<meta property="article:modified_time" content="2022-06-25T18:03:17+02:00" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Shloader - A Modern Shell Loader"/>
<meta name="twitter:description" content="Why Features Preview Templating Usage Parsing Arguments Shell Configurations Trap Error and Exit Display Loader Call Loader Scrip Library Integration Conclusion  Why I&rsquo;ve been recently doing some old shell scripts to quickly automatize and distribute actions that were made manually, I&rsquo;ll write a post on it later. For now I&rsquo;d like to share with you how I&rsquo;ve been coding a 100% shell loader library to use it in my scripts."/>



<meta itemprop="name" content="Shloader - A Modern Shell Loader">
<meta itemprop="description" content="Why Features Preview Templating Usage Parsing Arguments Shell Configurations Trap Error and Exit Display Loader Call Loader Scrip Library Integration Conclusion  Why I&rsquo;ve been recently doing some old shell scripts to quickly automatize and distribute actions that were made manually, I&rsquo;ll write a post on it later. For now I&rsquo;d like to share with you how I&rsquo;ve been coding a 100% shell loader library to use it in my scripts."><meta itemprop="datePublished" content="2022-06-25T18:03:17+02:00" />
<meta itemprop="dateModified" content="2022-06-25T18:03:17+02:00" />
<meta itemprop="wordCount" content="1410">
<meta itemprop="keywords" content="loader,shell,bash," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Le Baron de Charlus</h2>
</a>
<nav><a href="/">Home</a>

<a href="/posts/">Posts</a>

<a href="/tags/">Tags</a>

<a href="https://www.flickr.com/photos/lebarondecharlus/">Photography</a>

<a href="/cv">CV</a>

<a href="/index.xml"></a>


</nav>
</header>
  <main>

<content>
  <p><img src="/images/shloader.png" alt="Shloader"></p>
<ol>
<li><a href="#why">Why</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#preview">Preview</a></li>
<li><a href="#templating">Templating</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#parsing-arguments">Parsing Arguments</a></li>
<li><a href="#shell-configurations">Shell Configurations</a></li>
<li><a href="#trap-error-and-exit">Trap Error and Exit</a></li>
<li><a href="#display-loader">Display Loader</a></li>
<li><a href="#call-loader">Call Loader</a></li>
<li><a href="#script-library-integration">Scrip Library Integration</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<h1 id="why">Why</h1>
<p>I&rsquo;ve been recently doing some old shell scripts to quickly automatize and distribute actions that were made manually, I&rsquo;ll write a post on it later. For now I&rsquo;d like to share with you how I&rsquo;ve been coding a 100% shell loader library to use it in my scripts.</p>
<p>I&rsquo;ve been looking on the net for existing library, I&rsquo;ve found some interesting Github projects but it doesn&rsquo;t appear to be &ldquo;library&rdquo; ready. Furthermore, it was mostly old basic ASCII templates and I wanted to give a try to modern loaders and spinners on shell.</p>
<p>So I ended create <a href="https://github.com/lebaronlebaron.shloader"><code>shloader</code></a>.</p>
<h1 id="features">Features</h1>
<p>shloader has nice features such as :</p>
<p>😍 emoji support</p>
<p>💪 loader support</p>
<p>😎 dynamic message on load step</p>
<p>ℹ️  message on step ending</p>
<p>🎨 multiple loading templates</p>
<p>👌 light and easy to use on existing scripts</p>
<h1 id="preview">Preview</h1>
<p><img src="/images/shloader.gif" alt="Shloader"></p>
<h1 id="templating">Templating</h1>
<p>First of all, we need to create templates, one for each loaders that will be displayed. I&rsquo;ve decided to use shell <code>array</code> so we can work on iteration later on customs functions.</p>
<p>So I ended with something like :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># EMOJIS</span>
<span style="color:#008080">emoji_hour</span><span style="color:#000;font-weight:bold">=(</span> 0.08 <span style="color:#d14">&#39;🕛&#39;</span> <span style="color:#d14">&#39;🕐&#39;</span> <span style="color:#d14">&#39;🕑&#39;</span> <span style="color:#d14">&#39;🕒&#39;</span> <span style="color:#d14">&#39;🕓&#39;</span> <span style="color:#d14">&#39;🕔&#39;</span> <span style="color:#d14">&#39;🕕&#39;</span> <span style="color:#d14">&#39;🕖&#39;</span> <span style="color:#d14">&#39;🕗&#39;</span> <span style="color:#d14">&#39;🕘&#39;</span> <span style="color:#d14">&#39;🕙&#39;</span> <span style="color:#d14">&#39;🕚&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_face</span><span style="color:#000;font-weight:bold">=(</span> 0.08 <span style="color:#d14">&#39;😐&#39;</span> <span style="color:#d14">&#39;😀&#39;</span> <span style="color:#d14">&#39;😍&#39;</span> <span style="color:#d14">&#39;🙄&#39;</span> <span style="color:#d14">&#39;😒&#39;</span> <span style="color:#d14">&#39;😨&#39;</span> <span style="color:#d14">&#39;😡&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_earth</span><span style="color:#000;font-weight:bold">=(</span> 0.1 🌍 🌎 🌏 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_moon</span><span style="color:#000;font-weight:bold">=(</span> 0.08 🌑 🌒 🌓 🌔 🌕 🌖 🌗 🌘 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_orange_pulse</span><span style="color:#000;font-weight:bold">=(</span> 0.1 🔸 🔶 🟠 🟠 🔶 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_blue_pulse</span><span style="color:#000;font-weight:bold">=(</span> 0.1 🔹 🔷 🔵 🔵 🔷 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_blink</span><span style="color:#000;font-weight:bold">=(</span> 0.06 😐 😐 😐 😐 😐 😐 😐 😐 😐 😑 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_camera</span><span style="color:#000;font-weight:bold">=(</span> 0.05 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📷 📸 📷 📸 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_sick</span><span style="color:#000;font-weight:bold">=(</span> 0.2 🤢 🤢 🤮 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_monkey</span><span style="color:#000;font-weight:bold">=(</span> 0.2 🙉 🙈 🙊 🙈 <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">emoji_bomb</span><span style="color:#000;font-weight:bold">=(</span> 0.2 <span style="color:#d14">&#39;💣   &#39;</span> <span style="color:#d14">&#39; 💣  &#39;</span> <span style="color:#d14">&#39;  💣 &#39;</span> <span style="color:#d14">&#39;   💣&#39;</span> <span style="color:#d14">&#39;   💣&#39;</span> <span style="color:#d14">&#39;   💣&#39;</span> <span style="color:#d14">&#39;   💣&#39;</span> <span style="color:#d14">&#39;   💣&#39;</span> <span style="color:#d14">&#39;   💥&#39;</span> <span style="color:#d14">&#39;    &#39;</span> <span style="color:#d14">&#39;    &#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#998;font-style:italic"># ASCII</span>
<span style="color:#008080">ball</span><span style="color:#000;font-weight:bold">=(</span> 0.2 <span style="color:#d14">&#39;(●)&#39;</span> <span style="color:#d14">&#39;(⚬)&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">arrow</span><span style="color:#000;font-weight:bold">=(</span> 0.06 <span style="color:#d14">&#39;↑&#39;</span> <span style="color:#d14">&#39;↗&#39;</span> <span style="color:#d14">&#39;→&#39;</span> <span style="color:#d14">&#39;↘&#39;</span> <span style="color:#d14">&#39;↓&#39;</span> <span style="color:#d14">&#39;↙&#39;</span> <span style="color:#d14">&#39;←&#39;</span> <span style="color:#d14">&#39;↖&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">cym</span><span style="color:#000;font-weight:bold">=(</span> 0.1 <span style="color:#d14">&#39;⊏&#39;</span> <span style="color:#d14">&#39;⊓&#39;</span> <span style="color:#d14">&#39;⊐&#39;</span> <span style="color:#d14">&#39;⊔&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">x_plus</span><span style="color:#000;font-weight:bold">=(</span> 0.08 <span style="color:#d14">&#39;×&#39;</span> <span style="color:#d14">&#39;+&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">line</span><span style="color:#000;font-weight:bold">=(</span> 0.08 <span style="color:#d14">&#39;☰&#39;</span> <span style="color:#d14">&#39;☱&#39;</span> <span style="color:#d14">&#39;☳&#39;</span> <span style="color:#d14">&#39;☷&#39;</span> <span style="color:#d14">&#39;☶&#39;</span> <span style="color:#d14">&#39;☴&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">ball_wave</span><span style="color:#000;font-weight:bold">=(</span> 0.1 <span style="color:#d14">&#39;𓃉𓃉𓃉&#39;</span> <span style="color:#d14">&#39;𓃉𓃉∘&#39;</span> <span style="color:#d14">&#39;𓃉∘°&#39;</span> <span style="color:#d14">&#39;∘°∘&#39;</span> <span style="color:#d14">&#39;°∘𓃉&#39;</span> <span style="color:#d14">&#39;∘𓃉𓃉&#39;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">old</span><span style="color:#000;font-weight:bold">=(</span> 0.07 <span style="color:#d14">&#39;—&#39;</span> <span style="color:#d14">&#34;\\&#34;</span> <span style="color:#d14">&#39;|&#39;</span> <span style="color:#d14">&#39;/&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⣾&#39;</span> <span style="color:#d14">&#39;⣽&#39;</span> <span style="color:#d14">&#39;⣻&#39;</span> <span style="color:#d14">&#39;⢿&#39;</span> <span style="color:#d14">&#39;⡿&#39;</span> <span style="color:#d14">&#39;⣟&#39;</span> <span style="color:#d14">&#39;⣯&#39;</span> <span style="color:#d14">&#39;⣷&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots2</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠹&#39;</span> <span style="color:#d14">&#39;⠸&#39;</span> <span style="color:#d14">&#39;⠼&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠧&#39;</span> <span style="color:#d14">&#39;⠇&#39;</span> <span style="color:#d14">&#39;⠏&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots3</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠚&#39;</span> <span style="color:#d14">&#39;⠞&#39;</span> <span style="color:#d14">&#39;⠖&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠲&#39;</span> <span style="color:#d14">&#39;⠳&#39;</span> <span style="color:#d14">&#39;⠓&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots4</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⠆&#39;</span> <span style="color:#d14">&#39;⠇&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠸&#39;</span> <span style="color:#d14">&#39;⠰&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠰&#39;</span> <span style="color:#d14">&#39;⠸&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠇&#39;</span> <span style="color:#d14">&#39;⠆&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots5</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠚&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠲&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠖&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠓&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots6</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠁&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠚&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠲&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠲&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠚&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠁&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots7</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠈&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠓&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠖&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠖&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠓&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠈&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots8</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠁&#39;</span> <span style="color:#d14">&#39;⠁&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠙&#39;</span> <span style="color:#d14">&#39;⠚&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠲&#39;</span> <span style="color:#d14">&#39;⠴&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠤&#39;</span> <span style="color:#d14">&#39;⠦&#39;</span> <span style="color:#d14">&#39;⠖&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠒&#39;</span> <span style="color:#d14">&#39;⠓&#39;</span> <span style="color:#d14">&#39;⠋&#39;</span> <span style="color:#d14">&#39;⠉&#39;</span> <span style="color:#d14">&#39;⠈&#39;</span> <span style="color:#d14">&#39;⠈&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots9</span><span style="color:#000;font-weight:bold">=(</span> 0.04  <span style="color:#d14">&#39;⢹&#39;</span> <span style="color:#d14">&#39;⢺&#39;</span> <span style="color:#d14">&#39;⢼&#39;</span> <span style="color:#d14">&#39;⣸&#39;</span> <span style="color:#d14">&#39;⣇&#39;</span> <span style="color:#d14">&#39;⡧&#39;</span> <span style="color:#d14">&#39;⡗&#39;</span> <span style="color:#d14">&#39;⡏&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots10</span><span style="color:#000;font-weight:bold">=(</span> 0.04  <span style="color:#d14">&#39;⢄&#39;</span> <span style="color:#d14">&#39;⢂&#39;</span> <span style="color:#d14">&#39;⢁&#39;</span> <span style="color:#d14">&#39;⡁&#39;</span> <span style="color:#d14">&#39;⡈&#39;</span> <span style="color:#d14">&#39;⡐&#39;</span> <span style="color:#d14">&#39;⡠&#39;</span> <span style="color:#000;font-weight:bold">)</span>
<span style="color:#008080">dots11</span><span style="color:#000;font-weight:bold">=(</span> 0.04 <span style="color:#d14">&#39;⠁&#39;</span> <span style="color:#d14">&#39;⠂&#39;</span> <span style="color:#d14">&#39;⠄&#39;</span> <span style="color:#d14">&#39;⡀&#39;</span> <span style="color:#d14">&#39;⢀&#39;</span> <span style="color:#d14">&#39;⠠&#39;</span> <span style="color:#d14">&#39;⠐&#39;</span> <span style="color:#d14">&#39;⠈&#39;</span> <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Array composition is divided in two parts, the first one is a <code>time</code> interval in seconds and the second one is the loader frame transition.</p>
<h1 id="usage">Usage</h1>
<p>I wanted library to be used as commands can be, by passing argument through options.</p>
<p>First, let&rsquo;s work on default <code>usage</code> function to display to user.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">usage<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
  cat <span style="color:#d14">&lt;&lt;EOF
</span><span style="color:#d14">Available options:
</span><span style="color:#d14">-h, --help            &lt;OPTIONAL&gt;    Print this help and exit
</span><span style="color:#d14">-l, --loader          &lt;OPTIONAL&gt;    Chose loader to display
</span><span style="color:#d14">-m, --message         &lt;OPTIONAL&gt;    Text to display while loading
</span><span style="color:#d14">-e, --ending          &lt;OPTIONAL&gt;    Text to display when finishing
</span><span style="color:#d14">EOF</span>
  <span style="color:#0086b3">exit</span> <span style="color:#099">0</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>I wanted to define argument options as bellow :</p>
<h4 id="display-help">Display help</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># e.g</span>
shloader -h
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Parameter</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>-h --help</code></td>
<td style="text-align:left"><code>none</code></td>
<td style="text-align:left">Optional. Show help usage</td>
</tr>
</tbody>
</table>
<h4 id="chose-loader">Chose loader</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># e.g</span>
shloader -l arrow
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Parameter</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>-l --loader</code></td>
<td style="text-align:left"><code>string</code></td>
<td style="text-align:left">Optional. Chose loader template</td>
</tr>
</tbody>
</table>
<h4 id="display-info-on-loading">Display info on loading</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># e.g</span>
shloader -m <span style="color:#d14">&#34;my loading message&#34;</span> 
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Parameter</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>-m --message</code></td>
<td style="text-align:left"><code>string</code></td>
<td style="text-align:left">Optional. Show a text message while displaying loader</td>
</tr>
</tbody>
</table>
<h4 id="display-info-on-ending">Display info on ending</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># e.g</span>
shloader -e <span style="color:#d14">&#34;\u2728 all done&#34;</span>
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Parameter</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>-e --end</code></td>
<td style="text-align:left"><code>string</code></td>
<td style="text-align:left">Optional. Show an end text message when loader ends</td>
</tr>
</tbody>
</table>
<h1 id="parsing-arguments">Parsing Arguments</h1>
<p>In order to work on user input, it is necessary to read option content so we can modular library execution.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">shloader<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#008080">loader</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>
  <span style="color:#008080">message</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>
  <span style="color:#008080">ending</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>

  <span style="color:#000;font-weight:bold">while</span> :; <span style="color:#000;font-weight:bold">do</span>
    <span style="color:#000;font-weight:bold">case</span> <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">1</span>-<span style="color:#d14">}</span><span style="color:#d14">&#34;</span> in
    -h | --help<span style="color:#000;font-weight:bold">)</span> usage;;
    -l | --loader<span style="color:#000;font-weight:bold">)</span>
      <span style="color:#008080">loader</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">2</span>-<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
      <span style="color:#0086b3">shift</span>
      ;;
    -m | --message<span style="color:#000;font-weight:bold">)</span>
      <span style="color:#008080">message</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">2</span>-<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
      <span style="color:#0086b3">shift</span>
      ;;
    -e | --ending<span style="color:#000;font-weight:bold">)</span>
      <span style="color:#008080">ending</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">2</span>-<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
      <span style="color:#0086b3">shift</span>
      ;;
    -?*<span style="color:#000;font-weight:bold">)</span> die <span style="color:#d14">&#34;Unknown option: </span><span style="color:#008080">$1</span><span style="color:#d14">&#34;</span> ;;
    *<span style="color:#000;font-weight:bold">)</span> <span style="color:#0086b3">break</span> ;;
    <span style="color:#000;font-weight:bold">esac</span>
    <span style="color:#0086b3">shift</span>
  <span style="color:#000;font-weight:bold">done</span>

<span style="color:#000;font-weight:bold">[</span>…<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>You might notice I&rsquo;ve placed it directly in the main <code>function</code> so it will be the first element to be run.</p>
<p>If user don&rsquo;t specify loader, we should display one as default, let&rsquo;s say <code>dots</code> one.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># shloader func</span>
<span style="color:#000;font-weight:bold">[</span>…<span style="color:#000;font-weight:bold">]</span>

  <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[[</span> -z <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">loader</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">]]</span> ; <span style="color:#000;font-weight:bold">then</span>
    <span style="color:#008080">loader</span><span style="color:#000;font-weight:bold">=</span>dots<span style="color:#000;font-weight:bold">[</span>@<span style="color:#000;font-weight:bold">]</span> 
  <span style="color:#000;font-weight:bold">else</span>
    <span style="color:#008080">loader</span><span style="color:#000;font-weight:bold">=</span><span style="color:#008080">$loader</span><span style="color:#000;font-weight:bold">[</span>@<span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">fi</span>

<span style="color:#000;font-weight:bold">[</span>…<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>One last thing here, I use a little custom <code>die</code> function to exit properly if option is unknown.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">die<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#0086b3">local</span> <span style="color:#008080">code</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">2</span>-1<span style="color:#d14">}</span>
  <span style="color:#0086b3">exit</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$code</span><span style="color:#d14">&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h1 id="shell-configurations">Shell Configurations</h1>
<p>We will make some quick configuration on the top header script under <code>shebang</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span><span style="color:#998;font-style:italic"># https://github.com/lebaronlebaron.shloader</span>
<span style="color:#998;font-style:italic"># me@lebaron.sh</span>
<span style="color:#0086b3">set</span> -Eeuo pipefail
<span style="color:#0086b3">trap</span> end_shloader SIGINT SIGTERM ERR EXIT RETURN
tput civis
</code></pre></div><p>First, <code>set -Eeuo pipefail</code> so we can exit execution if one of the commands in the pipe fails.</p>
<p>Then, <code>trap end_shloader SIGINT SIGTERM ERR EXIT RETURN</code> so we can call a custom function to clean our execution on exiting, stopping, errors…</p>
<p>Finaly, <code>tput civis</code> is used to hide cursor.</p>
<h1 id="trap-error-and-exit">Trap Error and Exit</h1>
<p>Trap will call a custom function, but how does it work ?</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">end_shloader<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#0086b3">kill</span> <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">shloader_pid</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> &amp;&gt;/dev/null
  tput cnorm
  <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">[[</span> <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">ending</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span> <span style="color:#000;font-weight:bold">]]</span>; <span style="color:#000;font-weight:bold">then</span>
    <span style="color:#0086b3">printf</span> <span style="color:#d14">&#34;\r</span><span style="color:#d14">${</span><span style="color:#008080">ending</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span>; <span style="color:#0086b3">echo</span>
  <span style="color:#000;font-weight:bold">fi</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Right here I ensure first to kill loader&rsquo;s <code>PID</code> and restore cursor thanks to <code>tput cnorm</code>.</p>
<h1 id="display-loader">Display Loader</h1>
<p>Now we can interact with shell output to generate loading animations.</p>
<p>Let&rsquo;s create a new function <code>play_shloader()</code> :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">play_shloader<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000;font-weight:bold">while</span> <span style="color:#0086b3">true</span> ; <span style="color:#000;font-weight:bold">do</span>
    <span style="color:#000;font-weight:bold">for</span> frame in <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">loader</span>[@]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span> ; <span style="color:#000;font-weight:bold">do</span>
      <span style="color:#0086b3">printf</span> <span style="color:#d14">&#34;\r%s&#34;</span> <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">frame</span><span style="color:#d14">}</span><span style="color:#d14"> </span><span style="color:#d14">${</span><span style="color:#008080">message</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
      sleep <span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">speed</span><span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
    <span style="color:#000;font-weight:bold">done</span>
  <span style="color:#000;font-weight:bold">done</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Here we assume we have <code>loader</code> array we can display during time duration defined in <code>speed</code> variable (we will see it after).</p>
<h1 id="call-loader">Call Loader</h1>
<p>What about now ? We have all bricks to make great loaders, let&rsquo;s put them in work together !</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#998;font-style:italic"># shloader function</span>
<span style="color:#000;font-weight:bold">[</span>…<span style="color:#000;font-weight:bold">]</span>

  <span style="color:#008080">loader</span><span style="color:#000;font-weight:bold">=(</span> <span style="color:#d14">${</span>!loader<span style="color:#d14">}</span> <span style="color:#000;font-weight:bold">)</span>
  <span style="color:#008080">speed</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#d14">${</span><span style="color:#008080">loader</span>[0]<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>
  <span style="color:#0086b3">unset</span> <span style="color:#d14">&#34;loader[0]&#34;</span>

  tput civis
  play_shloader &amp;
  <span style="color:#008080">shloader_pid</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#d14">${</span>!<span style="color:#d14">}</span><span style="color:#d14">&#34;</span>

<span style="color:#000;font-weight:bold">[</span>…<span style="color:#000;font-weight:bold">]</span>
</code></pre></div><p>What is done here ?</p>
<p>We first print <code>loader</code> array content we save in <code>loader</code> variable. We know first element in array is time duration, so we save it in <code>speed</code> variable.</p>
<p>Now we have split array, we can remove time duration as it is now under <code>speed</code> variable.
We then hide cursor, call our <code>play_shloader</code> function and save <code>PID</code>.</p>
<p>You can find the <a href="https://github.com/lebaronlebaron.shloader/blob/main/lib/shloader.sh">Full Library Code</a></p>
<h1 id="script-library-integration">Script Library Integration</h1>
<p>Nothing hard here !</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#0086b3">source</span> ./lib/shloader.sh

shloader -l emoji_hour -m <span style="color:#d14">&#34;Testing&#34;</span> -e <span style="color:#d14">&#34;✨ All good !&#34;</span> 

  sleep <span style="color:#099">2</span>   <span style="color:#998;font-style:italic"># remove it in your code</span>
  <span style="color:#998;font-style:italic"># … your logic goes here</span>

end_shloader
</code></pre></div><p>With more details :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">!/bin/bash

<span style="color:#998;font-style:italic"># if you want to try just add this block code in your code </span>
<span style="color:#0086b3">source</span> ./lib/shloader.sh

<span style="color:#998;font-style:italic"># you can chose (see more in lib/loader.sh):</span>
<span style="color:#998;font-style:italic"># ball, arrow, cym, x_plus, line, ball_wave, npm and old.</span>
<span style="color:#998;font-style:italic"># you can specify message to display during loading</span>
<span style="color:#998;font-style:italic"># and message to display after your code finished</span>

<span style="color:#998;font-style:italic"># eg with npm style</span>
<span style="color:#998;font-style:italic"># notice end message -e use unicode emoji to display</span>
<span style="color:#998;font-style:italic"># this is for better terminal support</span>
<span style="color:#998;font-style:italic"># \u2728 == ✨ but you can use emoji if your settings support it !</span>
shloader -l emoji_face -m <span style="color:#d14">&#34;Testing&#34;</span> -e <span style="color:#d14">&#34;\u2728 All good !&#34;</span> 
  sleep <span style="color:#099">2</span>   <span style="color:#998;font-style:italic"># remove it in your code</span>

  <span style="color:#998;font-style:italic"># … your logic goes here</span>
  <span style="color:#998;font-style:italic"># if you want to hide some output from loader</span>
  <span style="color:#998;font-style:italic"># don&#39;t forget to redirect your STD*</span>
  <span style="color:#998;font-style:italic">#</span>
  <span style="color:#998;font-style:italic"># eg :</span>
  <span style="color:#998;font-style:italic"># STDOUT</span>
  <span style="color:#998;font-style:italic"># my_cmd 1&gt; /dev/null</span>
  <span style="color:#998;font-style:italic"># STDERR</span>
  <span style="color:#998;font-style:italic"># my_cmd 2&gt; /dev/null</span>
  <span style="color:#998;font-style:italic"># BOTH</span>
  <span style="color:#998;font-style:italic"># my_cmd &amp;&gt; /dev/null</span>

<span style="color:#998;font-style:italic"># stop loader</span>
end_shloader
</code></pre></div><h1 id="conclusion">Conclusion</h1>
<p>As all things useless… it may become mandatory 😂.</p>

</content>
<p>
  
  <a href="https://lebaron.sh/tags/loader/">#loader</a>
  
  <a href="https://lebaron.sh/tags/shell/">#shell</a>
  
  <a href="https://lebaron.sh/tags/bash/">#bash</a>
  
</p>

  </main>
  <footer><a href="https://lebaron.sh">© lebaron.sh</a>
</footer>

    
</body>

</html>
